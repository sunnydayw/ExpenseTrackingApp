# Drive Folder Architecture and Google Sheet Schema (Ground Truth in Google Drive)

This document defines the **canonical (ground truth)** storage layout in Google Drive and the **Google Sheet schema** for the ExpenseTracker app. The user is expected to be able to **edit the sheet directly**, so the schema prioritizes readability, stability, and low-friction editing.

---

## 1) Drive Folder Architecture (Predefined)

### 1.1 Root folder (portfolio)
- `PersonalFinanceApps/`

### 1.2 App root folder
Inside the portfolio folder, each app has its own root folder:
- `PersonalFinanceApps/ExpenseTracker/`

This structure supports future apps (examples):
- `PersonalFinanceApps/SmallBusinessExpenseTracker/`
- `PersonalFinanceApps/MileageTracker/`
- `PersonalFinanceApps/RealEstateTracker/`

### 1.3 Inside `ExpenseTracker/`
PersonalFinanceApps/
 -  ExpenseTracker/
    - Data/
        - ExpenseTracker.gsheet
    - Receipts/
        - 2026/
        - 2027/
    - Exports/ (optional; safe to include even if unused)

#### Folder purpose
- `Data/`  
  Holds the single Google Sheet used by the app.
- `Receipts/`  
  Holds all receipt images organized by year only.
- `Exports/`  
  Optional outputs (CSV exports, backup snapshots, etc.).

---

## 2) Receipt Storage Rules

### 2.1 Receipt folder rule (Year-only)
- New receipts go to: `Receipts/<YYYY>/`

Example:
- `Receipts/2026/`
- `Receipts/2027/`

### 2.2 Receipt file naming rule (required)
**Receipt file name format:**
- `<YYYYMMDD>_<Category>_<TransactionId>_<n>.jpg`

Where:
- `YYYYMMDD` = transaction date
- `Category` = category name (sanitized for filenames; see below)
- `TransactionId` = UUID from `Transactions.transactionId`
- `n` = 1-based index for multiple images per transaction (`1`, `2`, `3`, ...)

Examples:
- `20260110_Dining_4F8A2C6E-2F2C-4F35-8F61-5B9B7B1C2A11_1.jpg`
- `20260110_Dining_4F8A2C6E-2F2C-4F35-8F61-5B9B7B1C2A11_2.jpg`

**Category sanitization guidance (recommended):**
- Replace spaces with `-` (or remove spaces)
- Remove `/ \ : * ? " < > |` and other unsafe characters
- Keep it short (e.g., `Dining`, `Gas`, `Rent`)

### 2.3 Receipt identity rule (critical)
- The app must store the **Google Drive `driveFileId`** for each receipt image in the sheet.
- The file name is for human readability; the `driveFileId` is the stable handle (even if renamed/moved within the app folder).

---

## 3) Google Sheet File and Tabs

### 3.1 File location
- `PersonalFinanceApps/ExpenseTracker/Data/ExpenseTracker.gsheet`

### 3.2 Tabs (all created at initialization; not optional)
1. `Transactions`
2. `Receipts`
3. `Categories`
4. `RecurringRules`
5. `Settings`

---

## 4) Table Schemas (Tabs)

### 4.1 `Transactions` (ground truth ledger)
All transactions across all years live in this single tab.

| Column | Type | Notes |
|---|---|---|
| transactionId | string (UUID) | Primary key |
| type | string | `expense` / `income` |
| date | string (`YYYY-MM-DD`) | Transaction date |
| year | number | Derived or written by app for filtering |
| month | number | 1–12 (derived or written by app) |
| amount | number | Positive number |
| category | string | Category name (matches `Categories.name`) |
| tags | string | Comma-separated free text (user editable) |
| note | string | Optional |
| paidFlag | string | `paid` / `unpaid` / empty |
| reimbursedFlag | string | `reimbursed` / `unreimbursed` / empty |
| recurringRuleId | string (UUID) | Optional; empty if not generated by a rule |
| createdAt | string (ISO8601) | App-generated |
| lastModifiedAt | string (ISO8601) | App-generated; used for sync |

**Design notes**
- `year` and `month` are included to support efficient filtering and reporting without heavy parsing.
- `category` stores the **category name** (not an ID) to keep the sheet user-friendly.
- App assume **data validation** of `type`, `paidFlag`, `reimbursedFlag`, and `category` are correct even when user edit the sheet, however error handle should be consider when loading.
- App could apply Google Sheets **data validation** to keep `type`, `paidFlag`, `reimbursedFlag`, and `category` consistent in future.
---

### 4.2 `Receipts` (supports multiple receipts per transaction)
This tab is the authoritative mapping between transactions and receipt files.

| Column | Type | Notes |
|---|---|---|
| receiptId | string (UUID) | Primary key |
| transactionId | string (UUID) | FK to `Transactions.transactionId` |
| driveFileId | string | Google Drive file ID (stable handle) |
| fileName | string | Stored for display (e.g., the `<YYYYMMDD>_<Category>...` name) |
| createdAt | string (ISO8601) | App-generated |
| lastModifiedAt | string (ISO8601) | App-generated |
| isDeleted | boolean | Soft delete (default false) |

**Design notes**
- This structure enables **1-to-many** (one transaction → multiple receipt images).
- The app can show receipts by querying `Receipts` for a given `transactionId`.
- `driveFileId` is required to open the file reliably even if the name changes.

---

### 4.3 `Categories` (user co-managed reference list)
Defines the allowed categories and provides metadata used by the UI.

| Column | Type | Notes |
|---|---|---|
| name | string | Primary identifier (referenced by `Transactions.category`) |
| type | string | `expense` / `income` / `both` |
| emoji | string | Optional |
| colorHex | string | Optional (e.g., `#FFAA00`) |
| isActive | boolean | Allows disabling without deleting |
| sortOrder | number | Optional (UI ordering) |
| createdAt | string (ISO8601) | App-generated |
| lastModifiedAt | string (ISO8601) | App-generated |
| isDeleted | boolean | Soft delete (default false) |

**Design notes**
- Users can add/edit categories directly.
- App should use `isActive` to hide categories from pickers without breaking history.
- The `Transactions.category` column should ideally be a dropdown sourced from `Categories.name` (filtered to active).

---

### 4.4 `RecurringRules` (rule definitions; instances become Transactions)
Defines recurring transaction templates; the app materializes instances into `Transactions`.

| Column | Type | Notes |
|---|---|---|
| recurringRuleId | string (UUID) | Primary key |
| isEnabled | boolean | |
| type | string | `expense` / `income` |
| amount | number | Positive number |
| category | string | Category name (matches `Categories.name`) |
| tags | string | Comma-separated free text |
| note | string | Optional |
| startDate | string (`YYYY-MM-DD`) | |
| cadence | string | `daily` / `weekly` / `monthly` / `yearly` |
| interval | number | e.g., every 2 weeks = `cadence=weekly`, `interval=2` |
| endDate | string (`YYYY-MM-DD`) | Optional |
| createdAt | string (ISO8601) | App-generated |
| lastModifiedAt | string (ISO8601) | App-generated |
| isDeleted | boolean | Soft delete (default false) |

**Design notes**
- Recurring rules are persisted here; generated instances are written into `Transactions`.
- The `Transactions.recurringRuleId` links an instance back to its rule.

---

### 4.5 `Settings` (dataset identity + recovery)
Stores IDs required for reinstall / device change / recovery. Users generally do not edit this.

| Key | Value | Notes |
|---|---|---|
| datasetId | string (UUID) | Stable dataset identity of google drive folder PersonalFinanceApps|
| schemaVersion | number | For future migrations |
| timezone | string | e.g., `America/New_York` |
| rootFolderId | string | Drive folder ID of `PersonalFinanceApps/ExpenseTracker/` |
| dataSpreadsheetId | string | Spreadsheet file ID |
| receiptsFolderId | string | Drive folder ID of `Receipts/` |
| createdAt | string (ISO8601) | |
| lastModifiedAt | string (ISO8601) | |

---

## 5) Initialization and Operational Expectations

### 5.1 On first setup (app initialization)
The app should:
1. Ensure `PersonalFinanceApps/` exists.
2. Ensure `PersonalFinanceApps/ExpenseTracker/` exists.
3. Create subfolders: `Data/`, `Receipts/`, `Exports/`.
4. Create the spreadsheet `ExpenseTracker.gsheet` under `Data/`.
5. Create the tabs: `Transactions`, `Receipts`, `Categories`, `RecurringRules`, `Settings`.
6. Populate `Settings` with the folder/file IDs for recovery.

### 5.2 On receipt upload
The app should:
1. Compute year from the transaction date; ensure folder `Receipts/<YYYY>/` exists.
2. Name the file using: `<YYYYMMDD>_<Category>_<TransactionId>_<n>.jpg`
3. Upload to `Receipts/<YYYY>/`
4. Insert a row into the `Receipts` tab with `receiptId`, `transactionId`, `driveFileId`, and `fileName`.

---
